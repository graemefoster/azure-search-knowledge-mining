name: "Platform"

pool:
  name: Default

trigger:
  branches:
    include:
    - main
    - feature/private-deployment
  paths:
    include:
    - "00 - Resource Deployment"
    - "05 - Pipelines"


variables:
- group: KnowledgeMiningPortal

stages:
  - stage: "DeployWebApp"
    displayName: "Deploy Cogntive Search Index"
    jobs:
      - deployment: "DeployIndexes"
        environment: "Dev"
        steps:
        - task: AzurePowerShell@5
          name: 'DeployIndex'
          displayName: 'Deploy Index / Indexer to Cognitive Search Service'
          inputs:
            azureSubscription: 'PlatformServiceConnection'
            scriptType: 'filePath'
            scriptPath: './05 - Pipelines/Deploy-SearchIndex.ps1'
            azurePowerShellVersion: latestVersion
            scriptArguments: 
              -ResourcePrefix '$(ResourcePrefix)' `
              -CognitiveServicesKey '$(CognitiveServicesKey)' `
              -RootDirectory './00 - Resource Deployment/' `
              -StorageResourceId '$(StorageResourceId)' `
              -SearchServiceKey '$(SearchServiceKey)'

